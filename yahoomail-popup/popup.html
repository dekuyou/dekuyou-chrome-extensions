<html lang=ja>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>yahoomail</title>


<script>


var background = chrome.extension.getBackgroundPage();
var localurl;

window.addEventListener('load', function(e) {

	iframe = document.createElement("iframe");
	iframe.width = "325";
	iframe.height = "0"

	document.getElementById("body").appendChild(iframe);

	iframedoc = iframe.contentDocument;
	
	iframedoc.writeln('<body ></body>');

	// addBody();

	
	var xmlhttp = new window.XMLHttpRequest();
	
		xmlhttp.open("GET",'http://m.mail.yahoo.co.jp/' + "ipn/",false);
		xmlhttp.setRequestHeader('Content-Type', 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8');

		try{
			xmlhttp.onreadystatechange = function() { 
				if (this.readyState == 4) { 
					var text = this.responseText; 
					if(text.indexOf('var action = "folders"') > 0){
						addBody();
						return;
					}else{
						background.loginYmail();
						return;
					}
				} 
			}; 
		
		
			xmlhttp.send(null);
			
			

		}catch(e3){
			console.log('xmlhttp.responseText is ???:' + localStorage['domain'] + 'ipn/:' + e3); 		
		}
	


}, false);
var interval='';

var io = "hg/";

function addBody(localurl2){

	
	if(( localStorage["io"] || "" )+"" == "true"){
		io = 'hg/';
	}else{
		io = 'ipn/';
	}

	iframedoc.location.href= 'http://m.mg.mail.yahoo.co.jp/' + io;

	iframe.onload = function () {
		intervalId = setInterval("viwe()", 1); // 1*1000 = 1s
	}
	
	
	
}

var intervalId;
var iframe;
var i=0;
var heightPopup;
function viwe(){
	i=i+20;
	iframe.height = i + "";
	
	if(( localStorage["height"] || "" )+"" == "true"){
		heightPopup = '400';
	}else{
		heightPopup = '480';
	}
	if(i >heightPopup){
		clearInterval(intervalId);
		document.getElementById("load").innerHTML = "<img src=window_open.gif label='update Twitter.' onClick=openWindow();>";

	}
}

function openWindow(){

window.open('http://m.mg.mail.yahoo.co.jp/' + io , 'Y!メール', 'width=325, height='+heightPopup+', menubar=no, toolbar=no, scrollbars=yes');


}


</script>
</head>
<body >
<!--
<div id=yahoo><img src=loadinfo.net.gif></div>
-->
<table>
<tr>
<td>
<span align=left><a href=http://mail.yahoo.co.jp/ target=_blank> -> PCサイト</a></span>
</td>
<td align=rigth>
<span align=right id=load><img src=loadinfo.net.gif></span>
</td>

</tr>
<tr>
<td colspan=2>
<div id=body></div>
</td>
</tr>
</table>


</body> 
</html>


<!-- http://login.yahoo.co.jp/config/login_verify2?.src=ym -->
<!-- http://jp.f32.mail.yahoo.co.jp/ipn/ -->
